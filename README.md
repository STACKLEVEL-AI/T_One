# T_One - RAG-сервис для FAQ-поддержки

T_One — это RAG-сервис, который позволяет быстро развернуть систему "вопрос-ответ" по корпоративному FAQ без разметки и долгого обучения моделей. Источник знаний — Excel-таблица с официальными шаблонными ответами. Решение обеспечивает строгое соответствие коммуникациям из FAQ, предсказуемость, управляемую стоимость и низкую интеграционную сложность.

## Структура проекта

```
T_One/
├── compose.yml
├── .env.example
├── .gitignore
├── README.md
├── hakaton_back/
│   ├── combined_service.py
│   ├── dockerfile
│   ├── requirements.txt
│   ├── pyproject.toml
│   ├── .env.example
│   ├── .dockerignore
│   └── _smart_support_vtb_belarus_faq_final.xlsx
└── hakaton_front/
    ├── Dockerfile
    ├── package.json
    ├── tsconfig.json
    ├── vite.config.ts
    ├── .env.example
    ├── .prettierrc.json
    ├── components.json
    ├── eslint.config.js
    ├── public/
    └── src/
        ├── App.tsx
        ├── api/
        ├── components/
        ├── types.ts
        ├── utils/
        └── queryClient.ts
```
## Проекты

### Backend (hakaton_back)
- **Технологии**: Python 3.13, FastAPI, Uvicorn, ChromaDB, Pandas, openpyxl, Pydantic
- **Функциональность**:
  - REST/HTTP слой с эндпоинтами `/api/*`, `/search`, `/admin/*`, `/health`
  - Чтение FAQ из Excel файла
  - Индексация данных во векторной базе данных ChromaDB
  - Семантический поиск с использованием эмбеддингов (модель `bge-m3` через SciBox)
  - Выбор релевантных чанков с помощью LLM
  - Админ-эндпоинты для управления базой знаний
  - Кэширование результатов поиска

### Frontend (hakaton_front)
- **Технологии**: React 19.1.1, TypeScript ~5.9.3, Tailwind CSS, TanStack Query
- **Название**: tech_assistant
- **Функциональность**:
  - Интерфейс для пользователей (чат с поддержкой)
  - Интерфейс для администраторов поддержки
  - Взаимодействие с backend API
  - Отображение результатов поиска и генерации ответов

## Установка

1. Клонируйте репозиторий:
```bash
git clone <URL_репозитория>
cd T_One
```

2. Установите Docker и Docker Compose, если они еще не установлены

3. Скопируйте файлы конфигурации:
```bash
cp hakaton_back/.env.example hakaton_back/.env
cp hakaton_front/.env.example hakaton_front/.env
```

4. Настройте переменные окружения в файлах `.env`, указав необходимые API-ключи и параметры

5. Убедитесь, что ваш FAQ-файл (Excel) находится в директории `hakaton_back/` и указан в volumes в `compose.yml`

## Запуск проекта


### 1) Подготовка окружения

Скопируйте `.env.example` в `.env` и заполните токен:

```bash
cp .env.example .env
# Обязательно укажите свой ключ
# SCIBOX_API_KEY=...
```

Обязательные переменные:
- `SCIBOX_API_KEY` — токен SciBox (обязательно)
- при необходимости можно переопределить пути/имена коллекции

### 2) Запуск через Docker Compose

```bash
docker compose up --build
```

Compose монтирует `./chroma_vtb` и Excel-файл, читает переменные из `.env` и публикует порты:
- Backend: `8001` (API)
- Frontend: `8080` (React dev server)

## Использование

### Для пользователей
1. Откройте веб-интерфейс по адресу `http://localhost:8080`
2. Введите ваш вопрос в текстовое поле
3. Нажмите "Отправить" для получения ответа от системы поддержки
4. Система покажет наиболее релевантный ответ из базы знаний

### Для администраторов поддержки
1. Перейдите в администраторский интерфейс
2. Загрузите или обновите FAQ-файл (Excel) через соответствующую форму
3. Используйте инструменты поиска для проверки корректности индексации
4. Мониторьте статистику запросов и качество ответов

### Для разработчиков
1. Установите зависимости: `pip install` для backend и `npm install` для frontend
2. Настройте переменные окружения в `.env` файле
3. Запустите приложение с помощью Docker Compose: `docker compose up --build`
4. Используйте API эндпоинты для интеграции с другими системами

## API Эндпоинты

### Health
- `GET /api/health` → `{ "ok": true }`
- `GET /health` → `{ "status": "healthy" }`

### Сообщения (демо-чат)
- `GET /api/messages` — список созданных сообщений (ин-мемори)
- `POST /api/messages` — создание нового сообщения с классификацией и предложением ответа

### Поиск
- `GET /search?query=Текст&k=8`
- `POST /search` — семантический поиск по FAQ

### Получить ответ LLM без сохранения
- `POST /api/llm-response` — получить ответ LLM на основе FAQ

### Админ-эндпоинты
- `POST /admin/reset-db` — удалить и создать коллекцию заново
- `GET  /admin/excel-content` — показать первые строки Excel
- `POST /admin/reload-excel` — принудительно перечитать Excel и перезагрузить коллекцию
- `POST /admin/test-search` — прогон тестового запроса

## Пользовательские сценарии

1. **Поддержка клиентов (FAQ)**: восстановление доступа, статусы операций, лимиты и т.п.
2. **Внутренний справочник**: ответы для операторов/агентов в едином стиле
3. **Подготовка бота/виджета**: бэкенд для веб-чата

## Ключевые свойства

- **Простота ввода знаний**: достаточно Excel-файла
- **Контролируемость ответа**: идёт от шаблона, а не "галлюцинаций"
- **Издержки под контролем**: стоимость прозрачно рассчитывается
- **Локальная работа**: векторное хранилище на диске, без внешних БД
- **Контейнеризация**: Docker / Compose, быстрое развертывание
- **Удобный интерфейс**: фронтенд для пользователей и администраторов

## Нефункциональные требования

- **Латентность**: P95 ≤ 800–1200 мс
- **Доступность**: ≥ 99.5% при работе в одном регионе
- **Безопасность**: секреты только через `.env`/Secret Manager; PII не логируется
- **Наблюдаемость**: логи, счётчики токенов, метрики кэша

## Ограничения и риски

- **Покрытие ответов** зависит от полноты Excel
- **Качество семантики** зависит от выбранной модели эмбеддингов
- **Консистентность** в кластере при локальном кэше — использовать Redis, если много реплик